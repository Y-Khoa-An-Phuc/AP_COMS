<div class="employee-view-container">
  <div class="employee-view-card">

    <!-- Filter Bar -->
    <div class="filter-bar">

      <!-- Center: Search Box -->
      <div class="filter-center">
        <mat-form-field appearance="outline" class="search-box">
          <mat-icon matPrefix class="search-icon">search</mat-icon>
          <input matInput
                 placeholder="Tìm Kiếm Nhanh Trong Danh Sách"
                 [(ngModel)]="searchText"
                 (input)="onSearch()">
        </mat-form-field>
      </div>

      <!-- Right: Action Buttons -->
      <div class="filter-right">
        <button mat-stroked-button class="export-btn" (click)="onExportExcel()">
          <mat-icon>upload</mat-icon>
          Xuất Excel
        </button>
        <button mat-raised-button class="add-btn" (click)="onAddEmployee()">
          Thêm Nhân Viên
        </button>
      </div>

    </div>

    <!-- Employee Table -->
    <div class="table-container">
      <table mat-table [dataSource]="dataSource" class="employee-table">

        <!-- Edit Icon Column -->
        <ng-container matColumnDef="edit">
          <th mat-header-cell *matHeaderCellDef class="edit-column"></th>
          <td mat-cell *matCellDef="let employee" class="edit-column">
            <button mat-icon-button class="edit-icon-btn" (click)="onEditEmployee(employee)">
              <mat-icon class="edit-icon">edit</mat-icon>
            </button>
          </td>
        </ng-container>

        <!-- Delete Icon Column -->
        <ng-container matColumnDef="delete">
          <th mat-header-cell *matHeaderCellDef class="delete-column"></th>
          <td mat-cell *matCellDef="let employee" class="delete-column">
            <button mat-icon-button class="delete-icon-btn" (click)="onDeleteEmployee(employee)">
              <mat-icon class="delete-icon">delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <!-- Checkbox Column -->
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef class="checkbox-column">
            <mat-checkbox (change)="onSelectAll($event.checked)" [checked]="isAllSelected()" [indeterminate]="isSomeSelected()"></mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let employee" class="checkbox-column">
            <mat-checkbox (change)="onSelectEmployee(employee, $event.checked)" [checked]="isSelected(employee)"></mat-checkbox>
          </td>
        </ng-container>

        <!-- Employee ID Column -->
        <ng-container matColumnDef="empId">
          <th mat-header-cell *matHeaderCellDef>Mã Nhân Viên</th>
          <td mat-cell *matCellDef="let employee">
            <a class="employee-code-link" (click)="onEmployeeClick(employee)">
              {{employee.empId}}
            </a>
          </td>
        </ng-container>

        <!-- Last Name Column -->
        <ng-container matColumnDef="lastName">
          <th mat-header-cell *matHeaderCellDef>Họ</th>
          <td mat-cell *matCellDef="let employee">{{employee.lastName}}</td>
        </ng-container>

        <!-- Middle Name Column -->
        <ng-container matColumnDef="middleName">
          <th mat-header-cell *matHeaderCellDef>Tên đệm</th>
          <td mat-cell *matCellDef="let employee">{{employee.middleName}}</td>
        </ng-container>

        <!-- First Name Column -->
        <ng-container matColumnDef="firstName">
          <th mat-header-cell *matHeaderCellDef>Tên</th>
          <td mat-cell *matCellDef="let employee">{{employee.firstName}}</td>
        </ng-container>

        <!-- Full Name Column -->
        <ng-container matColumnDef="fullName">
          <th mat-header-cell *matHeaderCellDef>Họ Và Tên</th>
          <td mat-cell *matCellDef="let employee">{{employee.fullName}}</td>
        </ng-container>

        <!-- Email Column -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let employee">{{employee.email}}</td>
        </ng-container>

        <!-- Phone Column -->
        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef>Số điện thoại</th>
          <td mat-cell *matCellDef="let employee">{{employee.phone}}</td>
        </ng-container>

        <!-- Occupation Column -->
        <ng-container matColumnDef="occupation">
          <th mat-header-cell *matHeaderCellDef>Nghề nghiệp</th>
          <td mat-cell *matCellDef="let employee">{{employee.occupation?.occName}}</td>
        </ng-container>

        <!-- Organization Column -->
        <ng-container matColumnDef="organization">
          <th mat-header-cell *matHeaderCellDef>Tổ chức</th>
          <td mat-cell *matCellDef="let employee">{{employee.organization?.orgLabel}}</td>
        </ng-container>

        <!-- Work Location Column -->
        <ng-container matColumnDef="workLocation">
          <th mat-header-cell *matHeaderCellDef>Địa điểm làm việc</th>
          <td mat-cell *matCellDef="let employee">{{employee.branch?.branchName}}</td>
        </ng-container>

        <!-- Hire Date Column -->
        <ng-container matColumnDef="hireDt">
          <th mat-header-cell *matHeaderCellDef>Ngày tuyển dụng</th>
          <td mat-cell *matCellDef="let employee">{{employee.hireDt | date:'dd/MM/yyyy'}}</td>
        </ng-container>

        <!-- Termination Date Column -->
        <ng-container matColumnDef="terminationDt">
          <th mat-header-cell *matHeaderCellDef>Ngày nghỉ việc</th>
          <td mat-cell *matCellDef="let employee">{{employee.terminationDt ? (employee.terminationDt | date:'dd/MM/yyyy') : '—'}}</td>
        </ng-container>

        <!-- Citizen ID Card Column -->
        <ng-container matColumnDef="citizenIdCard">
          <th mat-header-cell *matHeaderCellDef>Số CMND/CCCD</th>
          <td mat-cell *matCellDef="let employee">{{employee.citizenIdCard || '—'}}</td>
        </ng-container>

        <!-- Passport Column -->
        <ng-container matColumnDef="passport">
          <th mat-header-cell *matHeaderCellDef>Số hộ chiếu</th>
          <td mat-cell *matCellDef="let employee">{{employee.passport || '—'}}</td>
        </ng-container>

        <!-- Contract ID Column -->
        <ng-container matColumnDef="contractId">
          <th mat-header-cell *matHeaderCellDef>Mã hợp đồng</th>
          <td mat-cell *matCellDef="let employee">{{employee.contractId || '—'}}</td>
        </ng-container>

        <!-- Supervisor Employee Column -->
        <ng-container matColumnDef="supvEmployee">
          <th mat-header-cell *matHeaderCellDef>Mã NV quản lý</th>
          <td mat-cell *matCellDef="let employee">{{employee.supvEmployee || '—'}}</td>
        </ng-container>

        <!-- Work Status Column -->
        <ng-container matColumnDef="workStatus">
          <th mat-header-cell *matHeaderCellDef>Trạng thái</th>
          <td mat-cell *matCellDef="let employee">{{employee.workStatus}}</td>
        </ng-container>

        <!-- Created Timestamp Column -->
        <ng-container matColumnDef="createTimestamp">
          <th mat-header-cell *matHeaderCellDef>Ngày tạo</th>
          <td mat-cell *matCellDef="let employee">{{employee.createTimestamp | date:'dd/MM/yyyy HH:mm:ss'}}</td>
        </ng-container>

        <!-- Created By Column -->
        <ng-container matColumnDef="createUser">
          <th mat-header-cell *matHeaderCellDef>Người tạo</th>
          <td mat-cell *matCellDef="let employee">{{employee.createUser}}</td>
        </ng-container>

        <!-- Last Update Timestamp Column -->
        <ng-container matColumnDef="lastUpdateTimestamp">
          <th mat-header-cell *matHeaderCellDef>Ngày cập nhật</th>
          <td mat-cell *matCellDef="let employee">{{employee.lastUpdateTimestamp | date:'dd/MM/yyyy HH:mm:ss'}}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="employee-row"></tr>
      </table>
    </div>

  </div>
</div>
